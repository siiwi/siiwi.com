<div class="modal-dialog" style="width: 90%">
    <div class="modal-content">

        <!--Modal header-->
        <div class="modal-header">
            <button data-dismiss="modal" class="close" type="button">
                <span aria-hidden="true">&times;</span>
            </button>
            <h4 class="modal-title"><?php echo $language->get('product_main_add')->title;?></h4>
        </div>

        <div class="wz-heading wz-w-label bg-info">

            <!--Start Progress bar-->
            <div class="progress progress-xs">
                <div style="width: 0%; margin: 0px 12.5%;" class="progress-bar progress-bar-light"></div>
            </div>
            <!--End Progress bar-->

            <!--Start Nav-->
            <ul class="wz-steps wz-icon-bw wz-nav-off text-lg">
                <li class="col-xs-3 active">
                    <a data-toggle="tab" href="#product_main_add_step_tab_1" aria-expanded="true">
                        <span class="icon-wrap icon-wrap-xs icon-circle bg-light">
                            <span class="wz-icon icon-txt text-bold">1</span>
                            <i class="wz-icon-done fa fa-check"></i>
                        </span>
                        <small class="wz-desc box-block mar-top"><?php echo $language->get('product_main_add')->basic_info;?></small>
                    </a>
                </li>
                <li class="col-xs-3">
                    <a data-toggle="tab" href="#product_main_add_step_tab_2">
                        <span class="icon-wrap icon-wrap-xs icon-circle bg-light">
                            <span class="wz-icon icon-txt text-bold">2</span>
                            <i class="wz-icon-done fa fa-check"></i>
                        </span>
                        <small class="wz-desc box-block mar-top"><?php echo $language->get('product_main_add')->attribute_info;?></small>
                    </a>
                </li>
                <li class="col-xs-3">
                    <a data-toggle="tab" href="#product_main_add_step_tab_3">
                        <span class="icon-wrap icon-wrap-xs icon-circle bg-light">
                            <span class="wz-icon icon-txt text-bold">3</span>
                            <i class="wz-icon-done fa fa-check"></i>
                        </span>
                        <small class="wz-desc box-block mar-top">Address</small>
                    </a>
                </li>
                <li class="col-xs-3">
                    <a data-toggle="tab" href="#product_main_add_step_tab_4">
                        <span class="icon-wrap icon-wrap-xs icon-circle bg-light">
                            <span class="wz-icon icon-txt text-bold">4</span>
                            <i class="wz-icon-done fa fa-check"></i>
                        </span>
                        <small class="wz-desc box-block mar-top">Finish</small>
                    </a>
                </li>
            </ul>
            <!--End Nav-->

        </div>
        <div class="form-horizontal">
            <div class="panel-body">
                <div class="tab-content">

                    <!--First tab-->
                    <div id="product_main_add_step_tab_1" class="tab-pane active in">
                        <div class="form-group">
                            <label class="col-sm-3 control-label text-danger"><?php echo $language->get('product_main_add')->name;?></label>
                            <div class="col-sm-7">
                                <input type="text" class="form-control input-sm" name="add_product_name" />
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label text-danger"><?php echo $language->get('product_main_add')->category;?></label>
                            <div class="col-sm-7">
                                <select tabindex="-1" style="width:301px;" name="add_product_category">
                                    <option value="0"><?php echo $language->get('product_main_add')->select;?></option>
                                    <?php if(is_array($product_main_add['category_list']) && !empty($product_main_add['category_list'])):?>
                                        <?php foreach($product_main_add['category_list'] as $category):?>
                                            <option value="<?php echo $category['category_id'];?>"><?php echo $category['name'];?></option>
                                        <?php endforeach;?>
                                    <?php endif;?>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label text-danger"><?php echo $language->get('product_main_add')->brand;?></label>
                            <div class="col-sm-7">
                                <select tabindex="-1" style="width:301px;" name="add_product_brand">
                                    <option value="0"><?php echo $language->get('product_main_add')->select;?></option>
                                    <?php if(is_array($product_main_add['brand_list']) && !empty($product_main_add['brand_list'])):?>
                                    <?php foreach($product_main_add['brand_list'] as $brand):?>
                                    <option value="<?php echo $brand['brand_id'];?>"><?php echo $brand['name'];?></option>
                                    <?php endforeach;?>
                                    <?php endif;?>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label text-danger"><?php echo $language->get('product_main_add')->supplier;?></label>
                            <div class="col-sm-7">
                                <select tabindex="-1" style="width:301px;" name="add_product_supplier">
                                    <option value="0"><?php echo $language->get('product_main_add')->select;?></option>
                                    <?php if(is_array($product_main_add['supplier_list']) && !empty($product_main_add['supplier_list'])):?>
                                    <?php foreach($product_main_add['supplier_list'] as $supplier):?>
                                    <option value="<?php echo $supplier['supplier_id'];?>"><?php echo $supplier['name'];?></option>
                                    <?php endforeach;?>
                                    <?php endif;?>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label"><?php echo $language->get('product_main_add')->sn;?></label>
                            <div class="col-sm-7">
                                <input type="text" class="form-control input-sm" name="add_product_sn" />
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label"><?php echo $language->get('product_main_add')->url;?></label>
                            <div class="col-sm-7">
                                <input type="text" class="form-control input-sm" name="add_product_url" />
                            </div>
                        </div>
                    </div>

                    <!--Second tab-->
                    <div id="product_main_add_step_tab_2" class="tab-pane">
                        <div class="form-group">
                            <label class="col-sm-1"></label>
                            <div class="col-sm-12 table-responsive" id="product_main_add_step_tab_2_table" style="overflow: auto; max-height: 400px;"></div>
                        </div>
                    </div>

                    <!--Third tab-->
                    <div id="product_main_add_step_tab_3" class="tab-pane">
                        <div class="form-group">
                            <label class="col-lg-3 control-label">Phone Number</label>
                            <div class="col-lg-7">
                                <input type="text" placeholder="Phone number" name="phoneNumber" class="form-control">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-lg-3 control-label">Address</label>
                            <div class="col-lg-7">
                                <input type="text" placeholder="Address" name="address" class="form-control">
                            </div>
                        </div>
                    </div>

                    <!--Fourth tab-->
                    <div id="product_main_add_step_tab_4" class="tab-pane mar-btm text-center">
                        <h4>Thank you</h4>
                        <p class="text-muted">Lorem ipsum dolor sit amet, consectetuer adipiscing elit, sed diam nonummy nibh euismod tincidunt ut laoreet dolore magna aliquam erat volutpat.</p>
                    </div>
                </div>
            </div>

            <!--Footer button-->
            <div class="panel-footer text-right">
                <p class="pull-left text-danger">*&nbsp;<?php echo $language->get('common')->required;?></p>
                <div class="box-inline">
                    <button type="button" class="previous btn btn-primary disabled"><?php echo $language->get('product_main_add')->previous;?></button>
                    <button type="button" class="next btn btn-primary"><?php echo $language->get('product_main_add')->next;?></button>
                    <button type="button" class="finish btn btn-primary"><?php echo $language->get('product_main_add')->finish;?></button>
                </div>
            </div>
        </div>
    </div>
</div>
<link href="/assets/plugins/x-editable/css/bootstrap-editable.css" rel="stylesheet">
<script src="/assets/plugins/bootstrap-wizard/jquery.bootstrap.wizard.min.js"></script>
<script src="/assets/plugins/x-editable/js/bootstrap-editable.min.js"></script>
<script>
var product_add_message = <?php echo json_encode($language->get('product_main_add')->message);?> || '';
var params = {};
$(function(){
    // step-1 供应商select样式
    $("select[name=add_product_supplier]").chosen({ width: '100%' }).change(function(){
        params.supplier_id = parseInt($("select[name=add_product_supplier]").val());
    });

    // step-1 品牌select样式
    $("select[name=add_product_brand]").chosen({ width: '100%' }).change(function(){
        params.brand_id = parseInt($("select[name=add_product_brand]").val());
    });

    // step-1 分类select样式
    $("select[name=add_product_category]").chosen({ width: '100%' }).change(function(){
        params.category_id = parseInt($(this).val());
        if(params.category_id) {
            var url = "<?php echo $url->link('product/attribute');?>&category_id="+params.category_id+"&type_id=2";
            $.get(url, function(response){
                var res = JSON.parse(response);
                var html = '';
                if(res.data.attribute_list.length) {
                    var th_html = '<thead>';
                    var td_html = '<tbody>';
                    for(var i = 0; i<res.data.attribute_list.length; i++) {
                        th_html += '<th class="min-width text-center">'+res.data.attribute_list[i].name+'</th>';
                        td_html += '<td><input type="text" class="form-control col-xs-2" value="" /></td>';
                    }
                    th_html += '<th class="min-width text-center text-danger"><?php echo $language->get("product_main_add")->sku;?></th>';
                    th_html += '<th class="min-width text-center text-danger"><?php echo $language->get("product_main_add")->purchase_price;?></th>';
                    th_html += '<th class="min-width text-center text-danger"><?php echo $language->get("product_main_add")->stock;?></th>';
                    th_html += '<th class="min-width text-center"><?php echo $language->get("common")->operating;?></th>';
                    th_html += '</thead>';
                    td_html += '<td><input type="text" class="form-control col-xs-2" value=""></td>';
                    td_html += '<td><input type="text" class="form-control col-xs-2" value=""></td>';
                    td_html += '<td><input type="text" class="form-control col-xs-2" value=""></td>';
                    td_html += '<td class="text-center"><div style="margin-top:4px;"><button class="btn btn-xs btn-danger delete_sku" style="display:none" data-toggle="tooltip" data-placement="top" title="<?php echo $language->get("common")->delete;?>"><i class="fa fa-times"></i></button>&nbsp;&nbsp;<button class="btn btn-xs btn-info add_sku" data-toggle="tooltip" data-placement="top" title="<?php echo $language->get("common")->add;?>"><i class="fa fa-plus"></i></button></div></td>';
                    td_html += '</tbody>';
                    html = '<table class="table table-striped">' + th_html + td_html + '</table>';
                } else {
                    html = '<center><?php echo $language->get("product_main_add")->no_attribute;?><a href="<?php echo $url->link("product/category");?>" class="text-info"><?php echo $language->get("common")->setting;?></a></center>';
                }
                $("#product_main_add_step_tab_2_table").html(html);
            });
        }
    });

    // 添加SKU行
    $("#product_main_add_step_tab_2_table").on('click', '.add_sku', function(){
        var element = $(this).parents('tr');
        var html = '<tr>' + element.html() + '</tr>';
        element.after(html);
        $(".delete_sku").show();
    });

    // 删除SKU行
    $("#product_main_add_step_tab_2_table").on('click', '.delete_sku', function(){
        var size = $("#product_main_add_step_tab_2_table>table>tbody>tr").size();
        if(size > 1) {
            $(this).parents('tr').remove();
        }

        if(size <= 2) {
            $(".delete_sku").hide();
        }
    });

    // wizard样式
    $('.modal-content').bootstrapWizard({
        tabClass         : 'wz-steps',
        nextSelector     : '.next',
        previousSelector : '.previous',
        finishSelector   : '.finish',
        onTabClick: function(tab, navigation, index) {
            return false;
        },
        onInit : function(){
            $('.modal-content').find('.finish').hide().prop('disabled', true);
        },
        onTabShow: function(tab, navigation, index) {
            var total   = navigation.find('li').length;
            var current = index+1;
            var percent = (index/total) * 100;
            var wdt     = 100/total;
            var lft     = wdt*index;
            var margin  = (100/total)/2;
            $('.modal-content').find('.progress-bar').css({width:percent+'%', 'margin': 0 + 'px ' + margin + '%'});

            if(current >= total) {
                $('.modal-content').find('.next').hide();
                $('.modal-content').find('.finish').show();
                $('.modal-content').find('.finish').prop('disabled', false);
            } else {
                $('.modal-content').find('.next').show();
                $('.modal-content').find('.finish').hide().prop('disabled', true);
            }
        },
        onNext: function(a, b, c) {
            // check step one
            if(c == 1) {
                params.name = $("input[name=add_product_name]").val();
                params.sn   = $("input[name=add_product_sn]").val();
                params.url  = $("input[name=add_product_url]").val();
                if(!params.name) {
                    swal('', product_add_message.empty_name, 'warning');
                    return false;
                }

                if(params.name.length < 2 || params.name.length > 50) {
                    swal('', product_add_message.invalid_name_length, 'warning');
                    return false;
                }

                if(!params.category_id) {
                    swal('', product_add_message.empty_category, 'warning');
                    return false;
                }

                if(!params.brand_id) {
                    swal('', product_add_message.empty_brand, 'warning');
                    return false;
                }

                if(!params.supplier_id) {
                    swal('', product_add_message.empty_supplier, 'warning');
                    return false;
                }
            }

            if(c == 2) {
                $("input[name^='sku[sku]']").each(function(a, b){
                    console.log(a);
                    console.log(b);
                    console.log($(this).val());
                });
                return false;
            }
        },
        onPrevious: function(a, b, c) {
            // console.log(a);
            // console.log(b);
            // console.log(c);
        },
        onFinish: function(a, b, c) {
            // console.log(a);
            // console.log(b);
            // console.log(c);
        }
    });
});
</script>
